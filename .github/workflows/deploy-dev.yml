name: Merge Changes

on:
  workflow_dispatch:
    inputs:
      target_branch:
        description: 'Branch to merge into (navi_dev or motor_dev)'
        required: true
        default: 'navi_dev'

jobs:
  merge:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout dev branch
        uses: actions/checkout@v2
        with:
          ref: dev

      - name: Validate target branch
        env:
          TARGET_BRANCH: ${{ github.event.inputs.target_branch }}
        run: |
          # Define allowed branches
          ALLOWED_BRANCHES=("navi_dev" "motor_dev")

          # Check if the target branch is in the list of allowed branches
          if [[ ! " ${ALLOWED_BRANCHES[@]} " =~ " ${TARGET_BRANCH} " ]]; then
            echo "Error: Branch '${TARGET_BRANCH}' is not allowed. Allowed branches are: ${ALLOWED_BRANCHES[@]}."
            exit 1
          fi

      - name: Checkout target branch
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.inputs.target_branch }}

      - name: Merge dev into target branch
        run: |
          git checkout ${{ github.event.inputs.target_branch }}
          git merge origin/dev --no-edit
          git push origin ${{ github.event.inputs.target_branch }}

      - name: Notify Success
        run: echo "Successfully merged dev into ${{ github.event.inputs.target_branch }}"
